<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hilos en Java [1]</title>
	
	<meta name="author" content="Franky Villadiego">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/eljaviador">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/villadiegofj">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a class="navbar-brand" href="/">
				<img src="http://www.gravatar.com/avatar/?s=35" class="img-circle" />
				
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<! -- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="http://www.gravatar.com/avatar/?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/"></a>
    </h3>
</header>


<div id="bio" class="text-center">
	Volando hacia el desarrollo productivo!
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/eljaviador">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/villadiegofj">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<! -- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Hilos en Java [1] </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   March 
	   30th,
	   
	   2011
	 </span>
	  <div class="article_body">
	  <p>Bueno esta es la primera de varias entregas sobre concurrencia o hilos en Java.  Vamos a tratar de ir de 0 a 100 para entender mejor todo este mundo de la multitaréa con el fin de aplicar lo que aprendamos en nuestros diseños de una forma mas optima.</p>

<h2 id="introduccin-a-los-hilos">Introducción a los Hilos</h2>
<p>Para no alargar mucho la historia ya que pueden conseguir bastantes definiciones por ahí, Java nos permite la ejecución de varios procesos al tiempo algo muy parecido a lo que hace el sistema operativo. Bueno realmente sabemos que con un solo núcleo o procesador solo se ejecuta un proceso a la vez, pero dada la velocidad con que se realizan para nosotros son como procesos paralelos. Con Java la <strong>JVM</strong> es nuestro pequeño sistema operativo en este caso y es la encargada con su sistema de scheduling (planificador) de manejar nuestros hilos o procesos de forma concurrente.</p>

<p>Si tuviéramos un sistema operativo como Solaris, es posible que la JVM haga un mapeo de cada hilo que nosotros creamos directamente a procesos del mismo sistema operativo.</p>

<p>Cuando hablamos de un HILO en Java tenemos dos posibles conceptos según el contexto:</p>

<ol>
  <li>Un hilo es una instancia de la clase <code>Thread</code> ubicada en el paquete <code>java.lang</code>.</li>
  <li>Un hilo es un proceso(Thread) de ejecución.</li>
</ol>

<p>Una instancia de <code>Thread</code> es un objeto común y corriente, de los que usamos con un simple new:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Thread</span> <span class="n">hilo</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">();</span></code></pre></div>

<p>Aquí solo he creado un simple objeto de tipo <code>Thread</code> y este tendrá variables, métodos, vivirá y morirá en el <strong>Heap</strong>. No es un hilo de ejecución porque no lo he iniciado como tal. </p>

<p>Un <em>Thread de ejecución</em> es un proceso individual con su propia <em><strong>PILA DE LLAMADAS</strong></em> (Call Stack).</p>

<h2 id="pila-de-llamadas">Pila de Llamadas</h2>
<p>En Java siempre hay aunque sea un único hilo ejecutándose, este hilo se crea al llamar al método <code>main()</code>. Es decir, siempre tengo un hilo llamado <em><strong>main</strong></em> que es el hilo inicial. Para este hilo main, se crea una pila de llamadas que no es mas que la secuencia en que los métodos se van invocando unos a otros.</p>

<p><img src="/images/hilos-01.jpg" alt="Hilos 01" /></p>

<p>Desde el método <code>main</code> llamaremos al <code>método1</code>, desde el <code>método1</code> llamamos al <code>método2</code> y así sucesivamente.</p>

<p>Para cada nuevo hilo que iniciamos se creara una pila de llamadas totalmente independiente una de otra. Si lanzamos dos hilos y cada uno llama al mismo método de una misma instancia de una clase(osea el mismo objeto en el heap), este se copia en cada pila sin interferir uno con otro. Cada hilo tendrá su propia copia del contenido de dicho método, sip, <em><strong>incuso de las variables locales</strong></em> (variables de método) y todo los declaremos dentro de dicho método. </p>

<p>Ojo que no pasa lo mismo con las variables o atributos de la instancia, osea <em><strong>el estado de ese objeto es compartido</strong></em> y si un hilo modifica un atributo el otro hilo vera ese cambio, pero ese tema lo vemos después con mas detalle, solo quería que entendieran el mecanismo de la pila de llamadas.</p>

<p><img src="/images/hilos-02.jpg" alt="Hilos 02" /></p>

<p>Cada vez que lanzamos un nuevo hilo, este nuevo call stack o pila de llamadas empieza con el método <code>run()</code>. Evidentemente el hilo principal empieza su stack con main.</p>

<h2 id="usando-hilos">Usando hilos</h2>
<p>La forma de usar hilos en Java es a través de la clase <code>java.lang.Thread</code>. Esto se puede hacer de dos formas:</p>

<ol>
  <li>Crear una clase que extienda de <code>Thread</code> y sobrescribir el método <code>run()</code>.</li>
  <li>Implementar la interface <code>Runnable</code> y pasarla a un objeto <code>Thread</code>.</li>
</ol>

<p>En cualquiera de los casos hay que usar un objeto <code>Thread</code>.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HiloUno</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Aqui mi codigo de ejecucion</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Principal</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">HiloUno</span> <span class="n">h1</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HiloUno</span><span class="o">();</span>
        <span class="n">HiloUno</span> <span class="n">h2</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HiloUno</span><span class="o">();</span>
        <span class="n">h1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>  <span class="c1">// Se crea pila de llamadas</span>
        <span class="n">h2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>  <span class="c1">// Se crea pila de llamadas</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Esta es la forma de lanzar o iniciar un hilo de ejecución. Usando el método <code>start()</code> estoy convirtiendo un simple objeto <code>Thread</code> en una nueva pila de llamadas, en este caso estamos lanzando dos procesos mas aparte del <em><strong>main</strong></em>, osea tenemos tres hilos de ejecución. Pero ojo si llamáramos solo el método <code>run()</code> sin usar <code>start()</code> estaríamos ejecutando un simple método en un simple objeto y no crearía ninguna pila de llamadas, osea no crearíamos ningún proceso aparte. </p>

<p>De la otra forma sería:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Ejecutor</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Aqui mi codigo de ejecucion</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Principal</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Ejecutor</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Ejecutor</span><span class="o">();</span>
        <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Pasar en el constructor de <code>Thread</code> un objeto <code>Runnable</code> y de igual manera iniciar el hilo de ejecución con <code>start()</code>. De hecho <code>Thread</code> tiene varios constructores y la misma clase <code>Thread</code> también implementa <code>Runnable</code> así que es posible pasar un <code>Thread</code> a otro a través de su constructor.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MiHilo</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Aqui mi codigo de ejecucion</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Principal</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MiHilo</span> <span class="n">h1</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MiHilo</span><span class="o">();</span>
        <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">h1</span><span class="o">);</span>
        <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>  <span class="c1">// Se crea pila de llamadas</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Generalmente se recomienda usar el segundo enfoque implementando <code>Runnable</code> porque es mas flexible en cuanto a diseño. En ocasiones mi modelo puede que no permite extender de <code>Thread</code> porque ya extiende de otra clase. Aunque usar el primer enfoque no quiere decir que precisamente este mal, como dije es cuestión de diseño o gustos .</p>

<h2 id="ciclo-de-vida">Ciclo de Vida</h2>
<p>Antes de pasar a trabajar más con los hilos conozcamos el ciclo de vida de estos. Cada <em>hilo de ejecución</em> tiene un ciclo de vida determinado por sus posibles estados.</p>

<p><img src="/images/hilos-03.jpg" alt="Hilos 03" /></p>

<ul>
  <li><strong>Nuevo :</strong> Este es el estado al crear una instancia de la clase <code>Thread</code>, pero aun no es un hilo vivo, no lo hemos iniciado con <code>start()</code>.</li>
  <li><strong>Ejecutable :</strong> Este estado aparece al llamar el método <code>start()</code> y aquí se convierte en un hilo vivo con su propia pila de llamadas.</li>
  <li><strong>Ejecutandose :</strong> Este estado indica que el hilo esta ejecutando parte del código del método <code>run()</code>.</li>
  <li><strong>Esperando / Bloqueado / Dormido :</strong> Estos estados aparecen por algún motivo, el propio hilo se fue a dormir, esta en espera de algún recurso, el planificador lo decidió, etc.</li>
  <li><strong>Muerto :</strong> El hilo se considera muerto cuando terminó la ejecución del método <code>run()</code>.</li>
</ul>

<p>Podemos obtener el estado de un hilo con el método <code>getState()</code> de <code>Thread</code>. Este retorna un enum que pertenece a la misma clase. </p>

<p>El planificador posee una especie de bolsa donde echa todos los hilos en estado <em><strong>Ejecutable</strong></em> para luego seleccionar uno y ponerlo en ejecución. La decisión de cual hilo seleccionar para ejecutar siempre pertenece al planificador, aunque bajo ciertas condiciones pudiéramos influenciar al planificador, por ejemplo especificando las prioridades de algunos hilos no significa que lo podemos controlar.</p>

<p>Hay varios escenarios por los cual el planificador puede sacar un hilo en ejecución y enviarlo a la bolsa de ejecutables o ponerlo en otro estado(esperando, bloqueado, dormido o muerto):</p>

<ul>
  <li>Completo el método <code>run()</code>.</li>
  <li>Hay una llamada al método <code>wait()</code> – Lo veremos después.</li>
  <li>Un hilo no pudo obtener el <em>bloqueo(Lock)</em> de un objeto - Lo veremos después.</li>
  <li>El planificador tomó la decisión según su criterio (porque le dio la gana ).</li>
</ul>

<p>Unos puntos para finalizar esta primera parte de hilos:</p>

<ol>
  <li>Un hilo en estado muerto(finalizó el método <code>run()</code>) no puede volver a iniciarse con <code>start()</code> ya que la JVM nos lanza una <code>IllegalThreadStateException</code>.</li>
  <li>Puedo encadenar hilos. Un hilo inicia solo cuando otro termine.</li>
  <li>Un hilo puede ceder el paso a otro y se va automáticamente de Ejecutándose a Ejecutable.</li>
  <li>Un hilo no puede bloquear a otro.</li>
</ol>

<p>Hasta aquí esta primera parte, see you later .</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#concurrencia-ref">
					concurrencia <span>(1)</span>
					
				</a></li>
			
		  
		</ul>
		  

		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Hilos en Java [1]&via=villadiegofj"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="http://www.gravatar.com/avatar/" class="img-rounded author-image" />
        <h4 class="section-title author-name">Franky Villadiego</h4>
        <p class="author-bio">Volando hacia el desarrollo productivo!</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/conceptos/principios/2011/03/14/principios-solid.html" title="Principios S.O.L.I.D">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/arquitectura/framework/2014/07/13/contenedor-spring.html" title="Contenedor Spring">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



		<footer>
			<hr/>
			<p>
				&copy; 2014 Franky Villadiego
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>

